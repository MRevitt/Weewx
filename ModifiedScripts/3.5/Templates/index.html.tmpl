#errorCatcher Echo
##    $Revision: 1669 $
##    $Author: mwall $
##    $Date: 2013-11-09 22:47:33 -0500 (Sat, 09 Nov 2013) $
##
## Specifying an encoding of UTF-8 is usually safe, but if your text is 
## actually in Latin-1, then you should replace the string "UTF-8" with "latin-1"
#encoding UTF-8
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head profile="http://www.w3.org/2005/10/profile">
    #if $encoding == 'utf8'
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    #end if
    <meta http-equiv="refresh" content="300" />
    <title>$station.location Current Weather Conditions</title>
    <link rel="stylesheet" type="text/css" href="weewx.css"/>
    <link rel="stylesheet" type="text/css" href="WeatherGauges.css"/>
    <link rel="icon" type="image/png" href="http://www.cougar.eu.com/Weewx/MountWeather/CougarLarge.png" />
    <script type="text/javascript" src="WeatherGauges.js"></script>
    <script type="text/javascript">
      function openURL(urlname)
      {
        window.location=urlname;
      }
      function openNoaaFile(date)
      {
        var url = "NOAA/NOAA-";
        url = url + date;
        url = url + ".txt";
        window.location=url;
      }
    </script>
  </head>

  <body>
    <!-- The following tag instantiates the Digital-7-Mono font and is required to load -->
    <!-- the font into the browser prior to using it in the Gauges.                     -->
    <!-- Text has to exist or it doesn't get called so we set the style to invisible.   -->
    <!-- and the height to 0 so that we can't see it.                                   -->
    <!-- This is then called by teh setTimeout command in the JavaScript file           -->
    <div id="Digital-7-Font" style="visibility: hidden; height: 0"<p>LED 1 2 3 4 </p></div>

    <div id="container">
      <div id="masthead">
        <h1>$station.location</h1>
        <h2>Current Weather Conditions</h2>
          <h3>$current.dateTime</h2>
      </div>

      <div id="statsGroup">
        <div class="statsAbout">
          <div class="statsHeader">
            About this weather station:
          </div>

          <table>
            <caption class="caption">Location</caption>
            <tr>
              <td class="label">Latitude:</td>
              <td class="data">$station.latitude[0]&deg; $station.latitude[1]' $station.latitude[2]</td>
            </tr>
            <tr>
              <td class="label">Longitude:</td>
              <td class="data">$station.longitude[0]&deg; $station.longitude[1]' $station.longitude[2]</td>
            </tr>
            <tr>
              <td class="label">Altitude:</td>
              <td class="data">$station.altitude</td>
            </tr>
          </table>
          <p>
            This station uses a <a href="http://davisnet.com/weather/products/professional-home-weather-stations.asp">
            Davis $station.hardware</a> weather station, controlled by <a href="http://www.weewx.com">'weewx'</a>, a
            Python based weather software system.
          </p>
          <p>Weewx uptime:  $station.uptime<br/>
             Server uptime: $station.os_uptime<br/>
             weewx v$station.version<br/>
             OSX $station.OS_version
          </p>
        </div> <!-- End id "statsAbout" -->

        <div class="statsAlmanac">
            ## Extended almanac information is available. Do the full set of tables.
            <table>
            <tr>
                <th colspan="2">Sun</th>
                <th colspan="2">Moon</th>
            </tr>
            <tr>
                <th colspan="2"><img src="backgrounds/Sun.png" alt="Sun" width="110" height="110"></th>
                <script>
                    document.write('<th colspan="2"><img src="backgrounds/' + '$almanac.moon_phase' + '.png" alt="Moon" width="80" height="80"></th>');
                </script>
            <tr>
                <td class="label">Sunrise:</td>
                <td class="data">$almanac.sun.rise</td>
                <td class="label">Moonrise:</td>
                <td class="data">$almanac.moon.rise</td>
            </tr>
            <tr>
                <td class="label">Sunset:</td>
                <td class="data">$almanac.sun.set</td>
                <td class="label">Moonset:</td>
                <td class="data">$almanac.moon.set</td>
            </tr>
            <tr>
                #if $almanac.next_equinox.raw < $almanac.next_solstice.raw
                ## The equinox is before the solstice. Display them in order.
                    <td class="label">Equinox:</td>
                    <td class="data">$almanac.next_equinox</td>
                #else
                ## The solstice is before the equinox. Display them in order.
                    <td class="label">Solstice:</td>
                    <td class="data">$almanac.next_solstice</td>
                #end if
                #if $almanac.next_full_moon.raw < $almanac.next_new_moon.raw
                    <td class="label">Full moon:</td>
                    <td class="data">$almanac.next_full_moon</td>
                #else
                    <td class="label">New moon:</td>
                    <td class="data">$almanac.next_new_moon</td>
                #end if
            </tr>
            <tr>
                ## This logic is deliberately wrong as we want the order reveresed here
                #if $almanac.next_equinox.raw < $almanac.next_solstice.raw
                ## The equinox is before the solstice. Display them in order.
                    <td class="label">Solstice:</td>
                    <td class="data">$almanac.next_solstice</td>
                #else
                ## The solstice is before the equinox. Display them in order.
                    <td class="label">Equinox:</td>
                    <td class="data">$almanac.next_equinox</td>
                #end if
                #if $almanac.next_full_moon.raw < $almanac.next_new_moon.raw
                    <td class="label">New moon:</td>
                    <td class="data">$almanac.next_new_moon</td>
                #else
                    <td class="label">Full moon:</td>
                    <td class="data">$almanac.next_full_moon</td>
                #end if
            </tr>
            <tr>
                <td colspan="3" class="label">Phase:</th>
                <td class="data">$almanac.moon_phase<br/>($almanac.moon_fullness% full)</td>
            </tr>
          </table>
        </div> <!-- End id "statsAlmanac" -->

       <p>&nbsp;</p>

        <div class="statsToday">
          <div class="statsHeader">Since Midnight</div>
          <table>
            <tbody>
              <tr>
                <td class="stats_label">
                  High Temperature<br/>
                  Low Temperature
                </td>
                <td class="stats_data">
                  $day.outTemp.max at $day.outTemp.maxtime<br/>
                  $day.outTemp.min at $day.outTemp.mintime
                </td>
              </tr>
              <tr>
                <td class="stats_label">
                  High Heat Index<br/>
                  Low Wind Chill
                </td>
                <td class="stats_data">
                  $day.heatindex.max at $day.heatindex.maxtime<br/>
                  $day.windchill.min at $day.windchill.mintime
                </td>
              </tr>
              <tr>
                <td class="stats_label">
                  High Humidity<br/>
                  Low Humidity
                </td>
                <td class="stats_data">
                  $day.outHumidity.max at $day.outHumidity.maxtime<br/>
                  $day.outHumidity.min at $day.outHumidity.mintime
                </td>
              </tr>
              <tr>
                <td class="stats_label">
                  High Dewpoint<br/>
                  Low Dewpoint
                </td>
                <td class="stats_data">
                  $day.dewpoint.max at $day.dewpoint.maxtime<br/>
                  $day.dewpoint.min at $day.dewpoint.mintime
                </td>
              </tr>
              <tr>
                <td class="stats_label">
                  High Barometer<br/>
                  Low Barometer
                </td>
                <td class="stats_data">
                  $day.barometer.max at $day.barometer.maxtime<br/>
                  $day.barometer.min at $day.barometer.mintime
                </td>
              </tr>
              <tr>
                <td class="stats_label">Barometer Trend ($trend.time_delta.hour.format("%.0f"))</td>
                <td class="stats_data">$trend.barometer</td>
              </tr>
              <tr>
                <td class="stats_label">Today's Rain</td>
                <td class="stats_data">$day.rain.sum</td>
              </tr>
              <tr>
                <td class="stats_label">High Rain Rate</td>
                <td class="stats_data">$day.rainRate.max at $day.rainRate.maxtime</td>
              </tr>
              <tr>
                <td class="stats_label">
                  Current Wind <br/>
                  High Wind
                </td>
                <td class="stats_data">
                  $current.windSpeed from $current.windDir ($current.windDir.ordinal_compass)<br/>
                  $day.wind.max from $day.wind.gustdir at $day.wind.maxtime
                </td>
              </tr>
              <tr>
                <td class="stats_label">
                  Average Wind
                </td>
                <td class="stats_data">
                  $day.wind.avg
                </td>
              </tr>
              <tr>
                <td class="stats_label">
                  RMS Wind
                </td>
                <td class="stats_data">
                  $day.wind.rms
                </td>
              </tr>

              <tr>
                <td class="stats_label">
                  Vector Average Speed<br/>
                  Vector Average Direction
                </td>
                <td class="stats_data">
                  $day.wind.vecavg<br/>
                  $day.wind.vecdir
                </td>
              </tr>

              <tr>
                <td class="stats_label">
                  High Inside Temperature<br/>
                  Low Inside Temperature
                </td>
                <td class="stats_data">
                  $day.inTemp.max at $day.inTemp.maxtime<br/>
                  $day.inTemp.min at $day.inTemp.mintime
                </td>
              </tr>
            </tbody>
          </table>
        </div> <!--End class "statsToday" -->

        <p>&nbsp;</p>

        <div class="statsMaps">
          #if $Extras.has_key('radar_img')
            <a href="$Extras.radar_url"><iframe src="$Extras.radar_img" scrolling=no width=355 height=355 style="border:6px double rgb(100,100,100)" alt="Radar"></iframe></a>
          #end if
        </div> <!--End class "statsMaps" -->
        
        <p>&nbsp;</p>
        
        <div class="statsVisitors">
            <p><img src="http://s05.flagcounter.com/count/DXQp/bg_F8FFFF/txt_000000/border_D8E6E6/columns_3/maxflags_40/viewers_0/labels_1/pageviews_1/flags_1/"></p>
        </div> <!--End class "statsVisitors" -->
      </div> <!--End class "statsGroup" -->

      <div id="content">
        <div id="about">
          <div class="header">Current Weather:</div>
          <div id="Gauges">
              <canvas id="CurrTemp"></canvas>
              <canvas id="WindChill"></canvas>
              <canvas id="Humidity"></canvas>
              <canvas id="Barometer"></canvas>
              <canvas id="Compass"></canvas>
              <canvas id="WindSpeed"></canvas>
          </div> <!-- End id "Gauges" -->
          <script type="text/javascript">
            drawGauge
            ({
                Canvas      : 'CurrTemp',
                MinValue    :   -10 ,
                MaxValue    :    40 ,
                MajorTicks  : ['-10','0','10','20','30','40'],
                TitleText   : 'Temperature',
                UnitsText   : '°C',
                LcdFormat   : { Integer     : 2,
                                Fraction    : 1
                              },
                Needle      : { Value : $current.outTemp.formatted },
                Highlights  : [{
                                From    : -10,
                                To      :  10,
                                Colour  : 'LightBlue'
                              },
                              {
                                From    :  10,
                                To      :  30,
                                Colour  : 'PaleGreen'
                              },
                              {
                                From    :  30,
                                To      :  40,
                                Colour  : 'LightSalmon'
                              }]
            });
            drawGauge
            ({
                Canvas      : 'WindChill',
                MinValue    :   -10,
                MaxValue    :    40,
                MajorTicks  : ['-10','0','10','20','30','40'],
                TitleText   : 'Wind Chill',
                UnitsText   : '°C',
                LcdFormat   : { Integer     : 2,
                                Fraction    : 1
                              },
                Needle      : { Value : $current.windchill.formatted  },
                Highlights  : [{
                                From    : -10,
                                To      :  10,
                                Colour  : 'LightBlue'
                              },
                              {
                                From    :  10,
                                To      :  30,
                                Colour  : 'PaleGreen'
                              },
                              {
                                From    :  30,
                                To      :  40,
                                Colour  : 'LightSalmon'
                              }]
            });
            drawGauge
            ({
                Canvas      : 'Humidity',
                TitleText   : 'Humidity',
                UnitsText   : '%',
                LcdFormat   : { Integer     : 2,
                                Fraction    : 1
                              },
                Needle      : { Value       :  $current.outHumidity.formatted,
                                StartColour : 'lightgreen',
                                EndColour   : 'navy' },
                Colours     : { MajorTick   : 'darkgreen',
                                MinorTick   : 'lightgreen',
                                Plate       : 'lightyellow',
                                Title       : 'green',
                                Units       : 'darkgreen',
                                Number      : 'darkgreen'
                              }
            });
            drawBarometer
            ({
                Canvas      : 'Barometer',
                Value       :  $current.barometer.formatted,
                Trend       : #if $trend.barometer.raw > 2.0
                                'Rising Rapidly'
                              #else if $trend.barometer.raw >  0.7
                                'Rising Slowly'
                              #else if $trend.barometer.raw < -2.0
                                'Falling Rapidly'
                              #else if $trend.barometer.raw < -0.7
                                'Falling Slowly'
                              #else
                                'Steady'
                              #end if
            });
            drawCompass
            ({
                Canvas      :  'Compass',
                Needle      : { Value       : "$current.windDir.raw"
                              }
            });
            drawGauge
            ({
                Canvas      : 'WindSpeed',
                TitleText   : 'Wind Speed',
                UnitsText   : 'MPH',
                MinValue    :    0,
                MaxValue    :   60,
                MajorTicks  : ['0','15','30','45','60'],
                MinorTicks  :   15,
                LcdFormat   : { Integer     : 3,
                                Fraction    : 0
                              },
                Needle      : { Value       : $current.windSpeed.formatted,
                                MaxValue    : $day.wind.max.formatted }
            });
          </script>
        </div> <!-- End id "about" -->

        <div id="plots">
          <iframe id="forecast_embed" type="text/html" frameborder="0" height="230" width="100%" src="https://forecast.io/embed/#lat=53.6610&lon=-1.8505&name=Huddersfield&color=#BBBBBB&units=UK"> </iframe>
          <a href="largeDaytempdew.png">     <img src="daytempdew.png"   alt="temperatures"    /></a>
          <a href="largeDaytempchill.png">   <img src="daytempchill.png" alt="heatchill"       /></a>
          <a href="largeDayrain.png">        <img src="dayrain.png"      alt="rain"            /></a>
          <a href="largeDaywind.png">        <img src="daywind.png"      alt="wind"            /></a>
          <a href="largeDaybarometer.png">   <img src="daybarometer.png" alt="barometer"       /></a>
          <a href="largeDaywinddir.png">     <img src="daywinddir.png"   alt="Hi Wind"         /></a>
          <a href="largeDayinside.png">      <img src="dayinside.png"    alt="Inside"          /></a>
          <a href="largeDayrx.png">          <img src="dayrx.png"        alt="day rx percent"  /></a>
        </div> <!-- End id "plots" -->
      </div> <!-- End id "content" -->

      <div id="navbar">
        <input type="button" value="    Home     " onclick="openURL('../../index.html')" />
        <input type="button" value="   Current   " onclick="openURL('index.html')" />
        <input type="button" value="    Week     " onclick="openURL('week.html')" />
        <input type="button" value="    Month    " onclick="openURL('month.html')" />
        <input type="button" value="    Year     " onclick="openURL('year.html')" />
        <p>Monthly summary:&nbsp;
        <select NAME=noaaselect onchange="openNoaaFile(value)">
        #for $monthYear in $SummaryByMonth
            <option value="$monthYear">$monthYear</option>
        #end for
            <option selected>-Select month-</option>
        </select>
        <br/>
        Yearly summary:&nbsp;
        <select NAME=noaaselect onchange="openNoaaFile(value)">
        #for $yr in $SummaryByYear
            <option value="$yr">$yr</option>
        #end for
            <option selected>-Select year-</option>
        </select>
        </p>
      </div><!-- End id "navbar" -->
    </div><!-- End id "container" -->
  </body>
</html>
